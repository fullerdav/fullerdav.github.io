<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <head>
  <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">

   <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
   integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin=""/>
 <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
   integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin=""></script>
<script src="js/mapdata.json"></script>
  
<style>

* {
  box-sizing: border-box;
}

h4 {
  text-align: center;
  padding-top: 8px;
}

section {
  height: 98vh;
  width: 85%;
  margin: 60px 10px;
}

#header {
  top: 0px;
  padding: 8px;
  font-size: 1.5em;
  font-family:  Roboto-slab;
  line-height: 1.4;
  position: fixed;
  height: 50px;
  z-index: 1500;
  width: 100%;
  text-align: center;
  background-color: #fff;
  color: #333;
  -webkit-box-shadow: 2px 2px 2px 0px rgba(0,0,0,0.3);
  -moz-box-shadow: 2px 2px 2px 0px rgba(0,0,0,0.3);
  box-shadow: 2px 2px 2px 0px rgba(0,0,0,0.3);
}
 
#mapid { 
  height: 80%; 
  width: 80%;
  margin:auto;
}

#linegraph {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  grid-gap: none;
  grid-auto-rows: minmax(100px, auto);
}

#linegraph .infocard {
    position: relative;
    background-color: #fff;
    color: #fff;
}

p {
    padding: 8px;
    margin-bottom: 10px;
    font-weight: 300;
    text-align: left;
    width: 60%;
}

.infocard {
    position: relative;
    /* border: 1px inset black; */
}
.infocard-header {
  background-color: hsla(200,30%, 55%, 0.8);
  color: white;
  text-align: center;
  font-weight: 600;
  font-border: ;
  padding: 8px 16px;
 font-kerning: auto;
 letter-spacing: .06em;
}
.description {
  
 /*  border-left: 1px inset black;
  border-right: 1px inset black; */
}
.infocard-footer {
    padding-top:8px;   
}

.center {
   text-align: center;
}

.cny {
  color: blue;
}
.ill {
  color: red;
}

div.nav {
  position: fixed;
  top: 0%;
  left: 85%;
  width:10vw;
  height: 100%;
}

ul.nav {
  list-style-type:none;
  position:fixed;
  top: 33%;
  padding: 0 8px;
  margin:auto;
  line-height: 2.5em;
  list-style-type:none;
}

ul.nav li {
  font-size: 1.5rem;
  transition-property: font-size;
  transition-duration: .25s;
}

ul.nav li.active {
 font-size: 1.5rem;
}

ul.nav li:hover {
  font-size: 2.5rem;
}

ul.nav li:before {
  content: '\25cf';
}

</style>
</head>


<body> 
<div id="header">
A comparison of <span class="ill center">Illiad</span> & <span class="cny">ConnectNY</span> returnables
</div>

<section id="map">
<a class="infocard">
  <div class="infocard-header">
    <span class="cny">ConnectNY</span> & <span class="ill">Illiad</span> borrowing requests from Fall 2013 through Summer 2017.
  </div>
  <div class="description" id="mapid">
  </div>
  <div class="infocard-footer center">
    Behold, the Empire Delivery Network, which delivers items for <span class="cny">ConnectNY</span> and libraries using IDS
  </div>
</a>
</section>

<section id="linegraph">
<a class="infocard">
  <div class="infocard-header">Student</div>
  <div class="description svg">
      <object id="ug" type="image/svg+xml" data="undergraduate.svg"></object>
  </div>
  <div class="infocard-footer"></div>
</a>

<a class="infocard">
  <div class="infocard-header">Faculty</div>
  <div class="description svg">
      <object id="fac" type="image/svg+xml" data="faculty.svg"></object>
  </div>
  <div class="infocard-footer"></div>
</a>
</section>

<section id="boxplot">
<a class="infocard">
  <div class="infocard-header">ILL turnaround time, Fall 2013 through Summer 2017</div>
  <div class="description svg">
      <object type="image/svg+xml" data="turnaround.svg"></object>
  </div>
  <div class="infocard-footer">
  <ul style="list-style-type:none; line-height:1.4em">
  <li>
  A boxplot shows a range of values according to quartiles, or 4 equal groups.  The boxy part represents half of the items borrowed for each term.  It is known as the <i>inner quartile</i>.
  </li><li>
  The band across the middle is the <b>median</b> and it is pretty steady across 4 years, <b>about 7 days</b>.
  </li><li>
  Extreme outliers (greater than 21 days) were excluded from the graph.
  </li>
  <li>
  The widest ranges, especially for the IQR are in the Summer, when academic library services are more unpredictable.
  </li>
  </ul>
  </div>
</a>
</section> 

<section id="summary">
<a class="infocard">
  <div class="infocard-header">Summary</div>
  <div class="description svg">
     We've been using IDS for about a year.  IDS "plugs in" to Illiad and helps to automate some of the more routine tasks, automtically searching our catalog and remote catalogs to determine the availability of items and routing requests more intelligently.
  </div>
  <div class="infocard-footer">
   From January through September 2017 Union borrowed 573 returnables via Illiad, 184 requests were filled within New York State while 136 of those were from IDS libraries. 
  </div>
</a>
<a class="infocard">
  <div class="infocard-header">Summary</div>
  <div class="description svg">
     We've been using IDS for about a year.  IDS "plugs in" to Illiad and helps to automate some of the more routine tasks, automtically searching our catalog and remote catalogs to determine the availability of items and routing requests more intelligently.
  </div>
  <div class="infocard-footer">
   From January through September 2017 Union borrowed 573 returnables via Illiad, 184 requests were filled within New York State while 136 of those were from IDS libraries. 
  </div>
</a>
</section>

<div class="nav">
<ul class="nav">
<li class="nav active" data-id="map"></li>
<li class="nav" data-id="linegraph"></li>
<li class="nav" data-id="boxplot"></li>
<li class="nav" data-id="summary"></li>
</ul>
</div>

<script>
const {log} = console;  
//center of US [44.58, -103.46]
//Union [42.817222, -73.9279]

const mymap = L.map('mapid').setView( [42.502222,-75.911667], 7);
 //mymap.createPane("labels");
 //mymap.getPane('labels').style.zIndex = 650;
 //mymap.getPane('labels').style.pointerEvents = 'none';

L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
   // pane:'labels',
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
}).addTo(mymap);


var myStyle = {
    "color": "#000",
    "weight": 1.5,
    "opacity": 0.65,
    "fillOpacity": 0
};
    
L.geoJSON(empireDelivery, {"style":myStyle}).addTo(mymap);
//L.geoJSON(cnycoll,{"style":myStyle}).addData(mymap);

let ills = [], cnys = [], hist = [];

illiads.forEach(function(school, i){
  let {latlong, symbol, name, borrowed, turn} = school;
  let total = borrowed * 100;  // 
  let distance = Math.round(mymap.distance(latlong, [42.817222, -73.9279])/1609.34, 4);
 
  symbol = L.circle(latlong, {
      color: 'red',
      strokeWidth: 1,
      fillColor: 'firebrick',
      fillOpacity: 0.25,
      radius: total
  });
  let tiptext = name + "<br>distance: " + distance + "mi, <br>borrowed: " + borrowed + "<br>avg turnaround: " + turn;
  symbol.bindTooltip(tiptext);
  ills.push(symbol);
});

connectnys.forEach(function(school, i){
  let {latlong, symbol, name, borrowed} = school;
  let total = borrowed * 20;
  let distance = Math.round(mymap.distance(latlong, [42.817222, -73.9279])/1609.34, 4);
 
  symbol = L.circle(latlong, {
      color: 'blue',
      strokeWidth: 1,
      fillColor: 'skyblue',
      fillOpacity: 0.25,
      radius: total
  });
  let tiptext = name + "<br>distance: " + distance + "mi <br>borrowed: " + borrowed;
  symbol.bindTooltip(tiptext);
  cnys.push(symbol);
});

historical.forEach(function(h, i){
  symbol = L.circle(h.latlong, {
      color: 'blue',
      strokeWidth: 1,
      fillColor: 'skyblue',
      fillOpacity: 0.25,
      radius: 100
  });
  hist.push(symbol);
});

const ill_schools = L.layerGroup(ills);
const cny_schools = L.layerGroup(cnys);
const historic = L.layerGroup(hist);

const overlayMaps = {
    "Connect NY": cny_schools,
    "Illiad": ill_schools,
    "Titanic": historic
};
L.control.layers(overlayMaps).addTo(mymap);

var ug = document.getElementById('ug');
var fc = document.getElementById('fac');
[ug, fc].forEach(function(linegraph){
    linegraph.onload = function() {
        let undergrad = linegraph.contentDocument; 
        let svgpaths = undergrad.querySelectorAll('g');
          
        svgpaths.forEach(function(g) {
            if (g.hasAttribute("clip-path")) {
              let clip = g.getAttribute('clip-path');
              let num = Number(clip.match(/\d+/)[0]);
              if (num > 60 && num < 109) {
                  let p = g.querySelector('path'); 
                  p.style.strokeWidth = 2;  
                   p.onmouseover = function() { p.style.stroke = 'rgba(10%, 10%, 10%, 0.5)';}
                   p.onmouseout = function() { p.style.stroke = 'rgba(100%, 100%, 100%, 1)';}
              }
            }
          });
    }
});

var scroller = function(targ) {
    let sect = document.getElementById(targ.dataset.id);
    window.scrollTo({top: sect.offsetTop - 60, left: 0, behavior: 'smooth'});
}

document.querySelector('ul.nav').addEventListener('click',function(event){scroller(event.target);}, true);
const sectids = ["map", "linegraph", "boxplot", "summary"];

const sections = document.querySelectorAll('section');
sections.forEach(function(section){
    section.addEventListener('wheel', function(e) {
      e.preventDefault();
      let forward = e.deltaY > 0 ? true : false;
      let targid = sectids.indexOf(this.id);

      if (forward && targid < 3) {
        let next = document.getElementById(sectids[++targid]);
        window.scrollTo({top: next.offsetTop - 60, left: 0, behavior: 'smooth'});
      } else if (!forward && targid > 0) {
        let next = document.getElementById(sectids[--targid]);
        window.scrollTo({top: next.offsetTop - 60, left: 0, behavior: 'smooth'});
      }
    }, false);
});


 </script>

</body>
</html>

