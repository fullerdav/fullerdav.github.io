<html>  
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    <script type="text/javascript">      
      const {log} = console; 
      document.addEventListener('touchstart', null, {default: true});
      
      google.charts.load('current', {'packages':['table']});
      google.charts.setOnLoadCallback(loadXMLDoc);
      let records = [];
      // let active = 0;
      // let deleted = 0;
      let token = "";
      let url = 'https://api-na.hosted.exlibrisgroup.com/almaws/v1/analytics/reports?path=/shared/Union College NY 01UCNY_INST/Reports/David Reports/TwentyOnexTwo&limit=50&col_names=true&apikey=l7xxec32312a35ac43e3ba59dbcc4bdf7864';
      const baseurl = 'https://api-na.hosted.exlibrisgroup.com/almaws/v1/analytics/reports?';
        
      function loadXMLDoc() {
          let xmlhttp = new XMLHttpRequest();
          xmlhttp.onreadystatechange = function() {
              if (this.readyState == 4 && this.status == 200) {
                  let xmldoc = this.responseXML;
                  let finished = xmldoc.getElementsByTagName("IsFinished")[0].childNodes[0].nodeValue; 
                  finished = finished === "false" ? true : true;
                  parseData(xmldoc);

                  if (!finished) { 
                    if (token === "") { token = xmldoc.getElementsByTagName("ResumptionToken")[0].childNodes[0].nodeValue }; 
                    url = `${baseurl}token=${token}&apikey=l7xxec32312a35ac43e3ba59dbcc4bdf7864`;
                    loadXMLDoc();
                  }
              } 
          };
          xmlhttp.open("GET", url);
          xmlhttp.send();
      };

      function parseData(xml) {
        let rows = Array.from(xml.getElementsByTagName("Row"));
     
        rows.forEach(row => {
            if (row.getElementsByTagName("Column9")[0]) {
                  let col1 = row.getElementsByTagName("Column1")[0].childNodes[0].nodeValue;
                  let col2 = row.getElementsByTagName("Column2")[0].childNodes[0].nodeValue;
                  let col3 = row.getElementsByTagName("Column3")[0].childNodes[0].nodeValue;
                  let col4 = row.getElementsByTagName("Column4")[0].childNodes[0].nodeValue;
                  let col5 = row.getElementsByTagName("Column5")[0].childNodes[0].nodeValue;
                  let col6 = row.getElementsByTagName("Column6")[0].childNodes[0].nodeValue;
                  let col7 = row.getElementsByTagName("Column7")[0].childNodes[0].nodeValue;
                  let col8 = row.getElementsByTagName("Column8")[0].childNodes[0].nodeValue;
                  let col9 = row.getElementsByTagName("Column9")[0].childNodes[0].nodeValue;

               // let col4 = row.getElementsByTagName("Column4")[0] ? row.getElementsByTagName("Column4")[0].childNodes[0].nodeValue : 0;
                  
                 records.push([col1, col2, col3, col4, col5, col6, col7, col8, col9]);  
            }
        });
        console.log(records);
        rows = null;
      }

      function drawTable() {
         let tbl = new google.visualization.DataTable({
              cols:[{label:'POCreate',type:'date'},{label:'PORecv',type:'date'},{label:'PORecvStatus',type:'string'},{label:'InvStatus',type:'string'},{label:'CreateItem',type:'date'},{label:'ModDate',type:'date'},{label:'RecvDate',type:'datetime'},{label:'ModItem',type:'date'},{label:'Title',type:'string'}]
          });
          let options = {showRowNumber:true, alternatingRowStyle:true, allowHtml: true, sort:'enable', sortAscending:true, page:'enable', pageSize:50}
          tbl.addRows(records);
          let table = new google.visualization.Table(document.getElementById('manifest'));
          table.draw(tbl, options);
      }
    </script>

    <style>
        h4 {
       /*   text-align:center; */
          color: #333;
          margin: 90px 0 36px 102px;
          font-weight:8`00;
        }

        #manifest {
          width: 90%;
          margin: 0 auto;
        }

    </style>
  </head>

  <body>          
    <div id="manifest"></div> 
  </body>
</html>
