<html>  
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    <script type="text/javascript">      
      const {log} = console; 
      document.addEventListener('touchstart', null, {default: true});
      
      google.charts.load('current', {'packages':['corechart','table']});
      google.charts.setOnLoadCallback(loadXMLDoc);
      let records = [];
      // let active = 0;
      // let deleted = 0;
      let token = "";
      let url = 'https://api-na.hosted.exlibrisgroup.com/almaws/v1/analytics/reports?path=/shared/Union College NY 01UCNY_INST/Reports/David Reports/TwentyOnexTwo&limit=50&col_names=true&apikey=l7xxec32312a35ac43e3ba59dbcc4bdf7864';
      const baseurl = 'https://api-na.hosted.exlibrisgroup.com/almaws/v1/analytics/reports?';
        
      function loadXMLDoc() {
          let xmlhttp = new XMLHttpRequest();
          xmlhttp.onreadystatechange = function() {
              if (this.readyState == 4 && this.status == 200) {
                  let xmldoc = this.responseXML;
                  let finished = xmldoc.getElementsByTagName("IsFinished")[0].childNodes[0].nodeValue; 
                  finished = finished === "false" ? false : true;
                  parseData(xmldoc);

                  if (!finished) { 
                    if (token === "") { token = xmldoc.getElementsByTagName("ResumptionToken")[0].childNodes[0].nodeValue }; 
                    url = `${baseurl}token=${token}&apikey=l7xxec32312a35ac43e3ba59dbcc4bdf7864`;
                    loadXMLDoc();
                  }
              } 
          };
          xmlhttp.open("GET", url);
          xmlhttp.send();
      };

      function parseData(xml) {
        let rows = Array.from(xml.getElementsByTagName("Row"));
     
        rows.forEach(row => {
            if (row.getElementsByTagName("Column9")[0]) {
                  let col1 = row.getElementsByTagName("POCreate")[0].childNodes[0].nodeValue;
                  let col2 = row.getElementsByTagName("PORecv")[0].childNodes[0].nodeValue;
                  let col3 = row.getElementsByTagName("RecvStatus")[0].childNodes[0].nodeValue;
                  let col4 = row.getElementsByTagName("InvStatus")[0].childNodes[0].nodeValue;
                  let col5 = row.getElementsByTagName("CreateItem")[0].childNodes[0].nodeValue;
                  let col6 = row.getElementsByTagName("ModDate")[0].childNodes[0].nodeValue;
                  let col7 = row.getElementsByTagName("RecvDate")[0].childNodes[0].nodeValue;
                  let col8 = row.getElementsByTagName("ModItem")[0].childNodes[0].nodeValue;
                  let col9 = row.getElementsByTagName("Title")[0].childNodes[0].nodeValue;

               // let col4 = row.getElementsByTagName("Column4")[0] ? row.getElementsByTagName("Column4")[0].childNodes[0].nodeValue : 0;
                  
                 records.push([col1, col2, col3, col4, col5, col6, col7, col8, col9]);  
            }
        });
        rows = null;
      }

      function drawTable() {
         let tbl = new google.visualization.DataTable({
              cols: [{id: 'po1', label:'POCreate', type:'date'}, {id: 'po2', label: 'PORecv', type: 'date'}, {id: 'po3', label: 'PORecvStatus', type: 'string'},{id: 'po4', label: 'InvStatus', type: 'string'},{id: 'item1', label:'CreateItem', type:'date'},{id: 'item2', label:'ModDate', type:'date'},{id: 'item3', label: 'RecvDate', type:'datetime'},{id: 'item4', label:'ModItem', type:'date'},{id: 'title', label:'Title', type:'string'}]
          });
          let options = {showRowNumber: true, alternatingRowStyle: true, allowHtml: true, sort:'enable', sortAscending:true, sortColumn:7, page:'enable', pageSize:50}
          tbl.addRows(records);
          let table = new google.visualization.Table(document.getElementById('manifest'));
          table.draw(tbl, options);
      }
    </script>

    <style>
        h4 {
       /*   text-align:center; */
          color: #333;
          margin: 90px 0 36px 102px;
          font-weight:8`00;
        }

        #manifest {
          width: 90%;
          margin: 0 auto;
        }

    </style>
  </head>

  <body>          
    <div id="manifest"></div> 
  </body>
</html>
