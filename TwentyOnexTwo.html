<html>  
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    <style>
      .bigAndBoldClass {
         font-weight: 700;
         font-size:  18px;

      }

      .highlightClass {
        color: #000;
        background-color: aquamarine;
        font-weight: 700;
      }
  </style>
 
  </head>

  <body>          
    <div id="manifest"></div> 

    <script type="text/javascript">      
    
      const {log} = console; 
      document.addEventListener('touchstart', null, {default: true});
      
      google.charts.load('current', {'packages':['table']});
      google.charts.setOnLoadCallback(loadXMLDoc);
      let records = [];
      let token = "";
      let opts = {};
      let url = 'https://api-na.hosted.exlibrisgroup.com/almaws/v1/analytics/reports?path=/shared/Union College NY 01UCNY_INST/Reports/David Reports/TwentyOnexTwo&limit=50&col_names=true&apikey=l7xxec32312a35ac43e3ba59dbcc4bdf7864';
      const baseurl = 'https://api-na.hosted.exlibrisgroup.com/almaws/v1/analytics/reports?';
        
      function loadXMLDoc() {
          let xmlhttp = new XMLHttpRequest();
          xmlhttp.onreadystatechange = function() {
              if (this.readyState == 4 && this.status == 200) {
                  let xmldoc = this.responseXML;
                  let finished = xmldoc.getElementsByTagName("IsFinished")[0].childNodes[0].nodeValue; 
                  finished = finished === "false" ? true : true;
                  parseData(xmldoc);

                  if (!finished) { 
                    if (token === "") { token = xmldoc.getElementsByTagName("ResumptionToken")[0].childNodes[0].nodeValue }; 
                    url = `${baseurl}token=${token}&apikey=l7xxec32312a35ac43e3ba59dbcc4bdf7864`;
                    loadXMLDoc();
                  }
              } 
          };
          xmlhttp.open("GET", url);
          xmlhttp.send();
      };

      function parseData(xml) {
        let rows = Array.from(xml.getElementsByTagName("Row"));

        rows.forEach(row => {
            if (row.getElementsByTagName("Column9")[0]) {
                  let col1 = row.getElementsByTagName("Column7")[0].childNodes[0].nodeValue;
                  col1 = new Date(col1);
                  let col2 = row.getElementsByTagName("Column8")[0].childNodes[0].nodeValue;
                  col2 = new Date(col2);
                  let col3 = row.getElementsByTagName("Column9")[0].childNodes[0].nodeValue;
                  let col4 = row.getElementsByTagName("Column6")[0].childNodes[0].nodeValue;
                  let col5 = row.getElementsByTagName("Column2")[0].childNodes[0].nodeValue;
                  col5 = new Date(col5);
                  let col6 = row.getElementsByTagName("Column3")[0].childNodes[0].nodeValue;                
                  col6 = new Date(col6);
                  let col7 = row.getElementsByTagName("Column5")[0].childNodes[0].nodeValue;
                  col7 = new Date(col7);
                  let col8 = row.getElementsByTagName("Column4")[0].childNodes[0].nodeValue;
                  let col9 = row.getElementsByTagName("Column1")[0].childNodes[0].nodeValue;
                  records.push([col1, col2, col3, col4, col5, col6, col7, col8, col9]);  
            }
        });
        log(records);
        //log(rows);
        rows = null;
      }

      function drawTable() {
          let tbl = new google.visualization.DataTable();
          tbl.addColumn('datetime', 'PO Creation');
          tbl.addColumn('date', 'PO Recv');
          tbl.addColumn('string', 'PO Recv Status');
          tbl.addColumn('string', 'PO Inv Status');
          tbl.addColumn('date', 'Item Create');
          tbl.addColumn('date', 'Item Mod');
          tbl.addColumn('datetime', 'Item Recv');
          tbl.addColumn('string', 'Item Mod by');
          tbl.addColumn('string', 'Title');
          let options = {showRowNumber:true, height:'auto', page:'disable', sort:'enable', sortColumn:7};
          tbl.addRows(records);
          let table = new google.visualization.Table(document.getElementById('manifest'));
          table.draw(tbl, options);
      }

    </script>

  </body>
</html>
